!function(){for(var a,t=$(".Cards"),e=t.children(".Card"),d=[$(e)],n=0;n<3;n++)a=e.clone(),a.find(".TabHead, .TabItem").each(function(){this.dataset.tab="SKill"+(n+2)}),t.append(a),d.push($(a));window.cards=d}(),function(){window.kqd={page:0,pageMax:0,xhrUnlock:!0,dynmSearch:!0},window.kqe={toggles:$(".Toggle[data-x]"),rightNavi:$(".TabHead.RightNavi[data-tab=RightNavi]"),condName:$("#CondName"),search:$("#Search"),pagePrev:$(".PagePrev"),pageNext:$(".PageNext"),tips:$(".Tips")},window.kqs={page:$(".sPage"),pageMax:$(".sPageMax")},kqs.cards=window.cards,delete window.cards,window.kqf={retab:function(){$(".TabHead[data-tab]").unbind("click").click(function(){if(""==this.dataset.stop)return!1;var a,t,e=this.dataset.tab,d=this.dataset.page,n=this.dataset.func;return!!e&&(a=$(".TabHead[data-tab="+e+"]"),t=$(".TabItem[data-tab="+e+"]"),d&&(a.filter(":not([data-page="+d+"])").removeClass("active"),$(this).addClass("active"),t.filter(":not([data-page="+d+"])").addClass("hide"),t.filter("[data-page="+d+"]").removeClass("hide")),void(n&&(a.filter(":not([data-func="+n+"])").removeClass("active"),$(this).addClass("active"),kqf["tab"+e](n))))})},dealer:function(a){var t,e=a[0],d=kqs.cards;kqs.page.html(kqd.page=~~a[1]),kqs.pageMax.html(kqd.pageMax=~~a[2]);for(t in d)d[t].addClass("hide");for(t in e){var n=d[t],i=e[t];n[0].dataset.id=i.id,n.find(".sTitle").html("&lt;"+i.title+"&gt;"+i.name),n.find(".sCost").html(i.cost),n.find(".sJob").html(i.job),n.find(".sAttr").html(i.attr),n.find(".sKind").html(i.kind),n.find(".sRare").html(i.rare),n.find(".sHP").html(i.hp),n.find(".sAD").html(i.ad),n.find(".sAP").html(i.ap),n.find(".sHQ").html(i.hq),n.find(".sThumb").attr("src",""),n.find(".sThumb").attr("src","https://raw.githubusercontent.com/kairiquery/tcipqk/master/"+kq.conds.serv+"20/"+i.id+".png");var s=["awaken","normal","suport3"];for(var r in s){var l=s[r],o=i.skill[l]||[],c=0,k=n.find(".TabItem.Skill[data-page="+l+"]"),h=k.find(".TabHeader.SkillContent").empty(),f=k.find(".TabBox.SkillContent").empty();o.length||o.push({cond:"&nbsp;",content:"无"});for(var p in o){var m=o[p],g=$("<a>").addClass("TabHead").addClass("SkillContent").html(m.cond||"无").appendTo(h);g[0].dataset.tab="Skill"+t+l,g[0].dataset.page=c,"无"==g.html()&&p>0&&g.css("width","20%");var v="";for(var b in m.content)v+='<span class="TextRole">'+(m.content[b]||"无")+"</span>";var q=$("<div>").addClass("TabItem").addClass("SkillContent").html(v).appendTo(f);q[0].dataset.tab="Skill"+t+l,q[0].dataset.page=c++}h.find(":first-child").addClass("active")}var u=kq.conds.mark[0][7]?2:"通用"!=i.job?0:1;n.find(".TabHead.Skill").removeClass("primary").filter("[data-page="+s[u]+"]").addClass("primary"),n.removeClass("hide")}kqf.retab(),$(".TabHead.Skill.primary").click()},tabServ:function(a){kq.conds.serv=a,kqe.search.click()}}}(),function(){window.kq={conds:{serv:"cn",name:"",mark:[[]]},param:function(a){var t=$.extend({},kq.conds,{page:kqd.page,mark:kq.conds.mark.toString().replace(/\,/g,"~"),zero:/[1-9]/.test(kq.conds.mark.toString())?0:1});return a&&a(t),t},query:function(a,t,e,d){if(kqd.xhrUnlock)return kqd.xhrUnlock=!1,$.get({url:"kq/q",data:kq.param(a),success:t}).fail(e).always(function(){kqd.xhrUnlock=!0,d&&d()})}}}();!function(){kqe.toggles.click(function(e,a){var t=$(this),c=this.dataset.cond,n=this.dataset.x,d=this.dataset.y,r=this.dataset.z,i=t.hasClass("all");a&&(i=!0),"s"==n?(kqd.dynmSearch=!1,kqe.toggles.filter("[data-cond="+c+"]:not([data-x=s])").each(function(){$(this).addClass(i?"on":"off").removeClass(i?"off":"on").click()}),a||(kqd.dynmSearch=!0),t.toggleClass("all"),a||kq.query(function(e){e.page=1},kqf.dealer)):(e.ctrlKey&&!e.shiftKey?(kqd.dynmSearch=!1,kqe.toggles.filter("[data-cond="+c+"]:not([data-x="+n+"][data-y="+d+"][data-z="+r+"]):not([data-x=s])").each(function(){$(this).addClass("on").removeClass("off").click()}),a||(kqd.dynmSearch=!0),t.removeClass("on").addClass("off").click()):!e.ctrlKey&&e.shiftKey?(kqd.dynmSearch=!1,kqe.toggles.filter("[data-cond="+c+"]:not([data-x="+n+"][data-y="+d+"][data-z="+r+"]):not([data-x=s])").each(function(){$(this).addClass("off").removeClass("on").click()}),a||(kqd.dynmSearch=!0),t.removeClass("off").addClass("on").click()):(kqe.toggles.filter("[data-cond="+c+"][data-x="+n+"][data-y="+d+"][data-z="+r+"]").toggleClass("on").toggleClass("off"),c&&n&&d&&r&&(t.hasClass("on")?kq.conds.mark[n][d]|=r:kq.conds.mark[n][d]&=~r,kqd.dynmSearch&&kq.query(function(e){e.page=1},kqf.dealer))),a&&(kqd.dynmSearch=!0))})}(),function(){$(document).keydown(function(e){var a=document.activeElement;if("CondName"==a.id){if(13==e.keyCode)return e.shiftKey&&$("[data-cond][data-val=s]").trigger("click",{fourceON:!0}),kqe.search.click(),!1}else if(a==$(".sPage")[0]){if(13==e.keyCode){var t=$(e.target),c=t.html();return c>0&&c<=kqd.pageMax?kq.query(function(e){e.page=c},kqf.dealer):t.html(kqd.page),!1}}else{if(9==e.keyCode){for(var n=kqe.rightNavi.filter(".active"),d=!0;d;)n=n[e.shiftKey?"prev":"next"](),n.length||(n=kqe.rightNavi[e.shiftKey?"last":"first"]()),""!==n[0].dataset.notab&&(d=!1);return n.click(),!1}if(33==e.keyCode)return kqe.pagePrev.click(),!1;if(34==e.keyCode)return kqe.pageNext.click(),!1;if(35==e.keyCode)return kq.query(function(e){e.page=kqd.pageMax},kqf.dealer),!1;if(36==e.keyCode)return kq.query(function(e){e.page=1},kqf.dealer),!1;if(83==e.keyCode&&e.ctrlKey)return kqe.condName.focus(),!1;if(13==e.keyCode&&e.shiftKey)return $("[data-cond][data-x=s]").trigger("click",{}),kqe.search.click(),!1}})}(),function(){kqe.search.click(function(){kqd.dynmSearch=!0,kq.conds.name=kqe.condName.val(),kq.query(function(e){e.page=1},kqf.dealer)}),kqe.pagePrev.click(function(){kqd.page>1&&kq.query(function(e){e.page--},kqf.dealer)}),kqe.pageNext.click(function(){kqd.page<kqd.pageMax&&kq.query(function(e){e.page++},kqf.dealer)})}(),function(){$(".sThumb").bind("error",function(){var e=this.src;return/20\//.test(e)?void(this.src=e.replace(/20\//g,"21/")):/21\//.test(e)?void(this.src="./kq/img/no20.png"):void 0})}(),function(){kqf.retab(),$(".TabHead").filter(".active").click(),kqe.search.click()}();